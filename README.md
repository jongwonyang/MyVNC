> [!IMPORTANT]
> **ë³´ì•ˆìƒ ì´ìœ ë¡œ ì „ì²´ ì†ŒìŠ¤ì½”ë“œëŠ” ê³µê°œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**
> 
> **ì´ ì €ì¥ì†ŒëŠ” 2025-03 ì´í›„ ë¹„ê³µê°œë¡œ ì „í™˜ë©ë‹ˆë‹¤.**

# MyVNC

| í•­ëª©          | ë‚´ìš© |
|--------------|------|
| ğŸ•’ ê¸°ê°„      | 2023-11 ~ 2023-12 |
| ğŸ‘¥ ì¸ì›      | 1ëª… |
| ğŸ›  ì‚¬ìš© ê¸°ìˆ  | <img src="https://img.shields.io/badge/java-%23ED8B00.svg?style=for-the-badge&logo=openjdk&logoColor=white" alt="Java"/> <img alt="Spring" src="https://img.shields.io/badge/spring-%236DB33F.svg?style=for-the-badge&logo=spring&logoColor=white" alt="Spring"/> <img src="https://img.shields.io/badge/Thymeleaf-%23005C0F.svg?style=for-the-badge&logo=Thymeleaf&logoColor=white" alt="Thymeleaf"/> <img src="https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white" alt="Postgres"/> <img src="https://img.shields.io/badge/Flutter-%2302569B.svg?style=for-the-badge&logo=Flutter&logoColor=white" alt="Flutter"/> |
| ğŸ¯ ë‹´ë‹¹ ì—­í•  | 1) í”„ë¡œê·¸ë¨ ë¶„ì„ ë° ì„¤ê³„<br/>2) í”„ë¡œí† íƒ€ì… ê°œë°œ (ë°±ì—”ë“œ, í”„ë¡ íŠ¸ì—”ë“œ) |
| ğŸ“– ê°œìš”      | ì˜¨í”„ë ˆë¯¸ìŠ¤ ì›ê²© ë°ìŠ¤í¬í†± ì†”ë£¨ì…˜ì˜ ì„¤ê³„ ë° í”„ë¡œí† íƒ€ì… ê°œë°œ |

# í”„ë¡œì íŠ¸ ê°œìš”
## ë°°ê²½ ë° ëª©í‘œ
Chrome Remote Desktop (ì´í•˜ CRD) ì²˜ëŸ¼ ì™¸ë¶€ ì„œë²„ë¥¼ ê±°ì¹˜ëŠ” ì›ê²© ë°ìŠ¤í¬íƒ‘ í”„ë¡œê·¸ë¨ì€ ë¯¼ê°í•œ ê°œì¸ì •ë³´ë¥¼ ë‹¤ë£¨ëŠ” ê¸°ê´€ì—ì„œ ì‚¬ìš©í•˜ê¸°ì— ì œì•½ì´ ìˆìŠµë‹ˆë‹¤. MyVNCëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì„œë²„ì— ì§ì ‘ ì„¤ì¹˜í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ì˜¨í”„ë ˆë¯¸ìŠ¤ ì›ê²© ë°ìŠ¤í¬íƒ‘ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.
## ì£¼ìš” ê¸°ëŠ¥
### ì›ê²© PC ì œì–´
1. ë¡œê·¸ì¸
![ë¡œê·¸ì¸](docs/myvnc-demo-1.png)
2. ë“±ë¡ëœ ì›ê²© PC ëª©ë¡
![ë“±ë¡ëœ ì›ê²© PC ëª©ë¡](docs/myvnc-demo-2.png)
3. ì—°ê²° ì•”í˜¸ ì…ë ¥
![ì—°ê²° ì•”í˜¸ ì…ë ¥](docs/myvnc-demo-3.png)
4. ì›ê²© PC ì œì–´
![ì›ê²© PC ì œì–´](docs/myvnc-demo-4.png)
5. ì›ê²© PC ì¡°ì‘ ë„êµ¬
![ì›ê²© PC ì¡°ì‘ ë„êµ¬](docs/myvnc-demo-5.png)

## ì›ê²© PC ë“±ë¡
1. ë“±ë¡í•  ì›ê²© PCì—ì„œ PC ëª©ë¡ í˜ì´ì§€ ì ‘ì† í›„ "ìƒˆ ì›ê²© PC ì¶”ê°€" ë²„íŠ¼ í´ë¦­
![ì›ê²© PC ì¡°ì‘ ë„êµ¬](docs/myvnc-demo-6.png)
2. ë‹¤ìš´ë¡œë“œëœ ë°ìŠ¤í¬íƒ‘ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì„¤ì¹˜
3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í›„ ë¡œê·¸ì¸ì‹œ ì—°ê²° ëŒ€ê¸° ìƒíƒœ

# ë‚˜ì˜ ê¸°ì—¬
## í”„ë¡œê·¸ë¨ ë¶„ì„, ì„¤ê³„
### ìƒí™©
ë‹¤ìŒê³¼ ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

"ì¥ë¹„ê´€ë¦¬ ë° ì ‘ì†ì„ ë‚´ë¶€ì—ì„œ í†µì œí•˜ì—¬ ë³´ì•ˆì„±ì„ ìœ ì§€"

ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì˜¨í”„ë ˆë¯¸ìŠ¤ í˜•íƒœë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì›ê²© PC ì œì–´ ì†”ë£¨ì…˜ì„ ì„¤ê³„í•˜ëŠ”ê²ƒì´ ëª©í‘œì˜€ìŠµë‹ˆë‹¤.

### ì„ í–‰ ê¸°ìˆ  ë¶„ì„
ì„¤ê³„ë¥¼ ìœ„í•´ ê¸°ì¡´ ì„ í–‰ ê¸°ìˆ ì¸ Chrome Remote Desktop í”„ë¡œê·¸ë¨ì„ ë¶„ì„í•˜ê³  ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

![CRD ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](docs/sequence-diagram-of-crd.png)

ì‹¤ì œ ì œì–´ í†µì‹ ì€ P2Pë¡œ ì¼ì–´ë‚˜ë”ë¼ë„, íšŒì› ë° ì¥ë¹„ ê´€ë¦¬ í†µì‹ ì´ êµ¬ê¸€ ì„œë²„ë¥¼ ê±°ì¹˜ëŠ” ë¬¸ì œì ì´ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶„ì„
VNC í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ [UltraVNC](https://github.com/ultravnc/UltraVNC) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì˜¤í”ˆì†ŒìŠ¤ì´ë©´ì„œ ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ì˜ í†µí•©ì„ ìœ„í•´ UltraVNC Repeaterë¼ëŠ” í¸ë¦¬í•œ íˆ´ì„ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ì„ ì •í–ˆìŠµë‹ˆë‹¤.

UltraVNC RepeaterëŠ” UltraVNC Serverì™€ Viewer ì‚¬ì´ì—ì„œ í”„ë¡ì‹œ ì—­í• ì„ í•˜ë©°, NAT ë°©í™”ë²½ ë’¤ì—ì„œë„ í¬íŠ¸ í¬ì›Œë”© ì—†ì´ ì›ê²© ì ‘ì†ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ì¤‘ê³„ ì„œë²„ì…ë‹ˆë‹¤.

ì„¤ê³„ë¥¼ ìœ„í•´ UltraVNCì˜ ì‘ë™ ë°©ì‹ì„ ë¶„ì„í•˜ê³  ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

![UVNC ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](docs/sequence-diagram-of-uvnc.png)

### ìµœì¢… ì„¤ê³„ ë„ì¶œ

CRDì—ì„œ êµ¬ê¸€ ì„œë²„ë¥¼ ê±°ì¹˜ëŠ” ë¶€ë¶„ì„ ì˜¨í”„ë ˆë¯¸ìŠ¤ Spring Appìœ¼ë¡œ êµì²´í•˜ê³  UltraVNC ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ìµœì¢… ì„¤ê³„ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

![MyVNC ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](docs/sequence-diagram-of-myvnc.png)

### ê²°ê³¼
"ê¸°ì¡´ í”„ë¡œê·¸ë¨ ë¶„ì„ -> ë¬¸ì œì  ë„ì¶œ -> ê¸°ìˆ  ì„ ì • -> ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì„¤ê³„ ì‘ì„±" ì´ë¼ëŠ” ê³¼ì •ì„ ê±°ì¹˜ë©° ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ê¸° ìœ„í•œ ì„¤ê³„ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ë³¸ ì„¤ê³„ ê³¼ì •ì„ í†µí•´ 1) í”„ë¡œí† íƒ€ì… ê°œë°œì— ë„ì›€ì´ ë˜ì—ˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ 2) ë™ë£Œ ê°œë°œìë¶„ë“¤ê»˜ ìµœì¢… ì„¤ê³„ë¥¼ ì´í•´ì‹œí‚¤ê³  ì •ë‹¹ì„±ì„ ë‚©ë“ì‹œí‚¤ëŠ”ë°ì—ë„ í° ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

## TCP ì´ë²¤íŠ¸ ë©”ì‹œì§•
### ìƒí™©
ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œ ì—°ê²°, ì œì–´ë“±ì„ ê´€ë¦¬í•˜ê³  í†µì œí•˜ê¸° ìœ„í•´ì„œëŠ” Spring Appì—ì„œ UltraVNCì˜ ì´ë²¤íŠ¸(PC ì—°ê²°, í•´ì œ, ì œì–´ ë“±)ë¥¼ ë°›ì•„ì˜¬ í•„ìš”ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

UltraVNCë¥¼ ì‚¬ìš©í•œ í•µì‹¬ì ì¸ ì´ìœ  ì¤‘ í•˜ë‚˜ê°€ ë‹¤ì–‘í•œ ì´ë²¤íŠ¸(PC ë“±ë¡, ì—°ê²°, í•´ì œ, ì œì–´ ë“±)ë¥¼ TCP ë©”ì‹œì§€ë¥¼ í†µí•´ ì œê³µí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ ë©”ì‹œì§€ë¥¼ ë°›ê³  ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ”ê²ƒì´ ëª©í‘œì˜€ìŠµë‹ˆë‹¤.

### UltraVNC ì„¤ì •
UltraVNCì˜ ì„¤ì • íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì—¬ ì´ë²¤íŠ¸ ë©”ì‹œì§€ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ê³  ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ëª©ì ì§€ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```ini
[eventinterface]
useeventinterface = true

eventlistenerhost = 127.0.0.1
eventlistenerport = 55555
```

### ë©”ì‹œì§€ ê°ì²´ ì •ì˜
UltraVNCì—ì„œ ìƒì„±ë˜ëŠ” ë©”ì‹œì§€ì˜ í˜•íƒœë¥¼ ì°¸ê³ í•˜ì—¬ ì´ì— ë§¤í•‘ì‹œí‚¬ ê°ì²´ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
@Data
public class EventMessage {

    private int evMsgVer;
    private int evNum;
    private long time;
    private int pid;
    private int tblInd;
    private long code;
    private int mode;
    private String ip;

    private int svrTblInd;
    private int vwrTblInd;
    private String svrIp;
    private String vwrIp;

    private int maxSessions;

    public Long getRepeaterId() {
        return code;
    }

    public static enum EvNum {
        VIEWER_CONNECT,                 // 0
        VIEWER_DISCONNECT,              // 1
        SERVER_CONNECT,                 // 2
        SERVER_DISCONNECT,              // 3
        VIEWER_SERVER_SESSION_START,    // 4
        VIEWER_SERVER_SESSION_END,      // 5
        REPEATER_STARTUP,               // 6
        REPEATER_SHUTDOWN,              // 7
        REPEATER_HEARTBEAT              // 8
    }
}
```

### ë©”ì‹œì§€ ìˆ˜ì‹ 
Spring Integrationì„ ì´ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ Spring Appì—ì„œ TCP ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í–¥í›„ í™•ì¥ì„±ê³¼ Spring ìƒíƒœê³„ì™€ì˜ í†µí•©ì„ ê³ ë ¤í•˜ì—¬ Spring Integrationì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

1. TCP ì„œë²„ ì„¤ì •
```java
@Configuration
@EnableIntegration
public class TcpServerConfig {

    @Value("${tcp.server.port}")
    private int port;

    @Bean
    public AbstractServerConnectionFactory connectionFactory() {
        TcpNioServerConnectionFactory connectionFactory = new TcpNioServerConnectionFactory(port);
        connectionFactory.setSerializer(TcpCodecs.lf());
        connectionFactory.setDeserializer(TcpCodecs.lf());
        return connectionFactory;
    }

    @Bean
    public TcpInboundGateway inboundGateway(AbstractServerConnectionFactory connectionFactory) {
        TcpInboundGateway tcpInboundGateway = new TcpInboundGateway();
        tcpInboundGateway.setConnectionFactory(connectionFactory);
        tcpInboundGateway.setRequestChannelName("inboundChannel");
        return tcpInboundGateway;
    }
}
```

2. ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •

```java
@MessageEndpoint
public class TcpServerEndpoint {
    private final MessageService messageService;

    public TcpServerEndpoint(MessageService messageService) {
        this.messageService = messageService;
    }

    @ServiceActivator(inputChannel = "inboundChannel", async = "true")
    public void process(byte[] message) {
        messageService.processMessage(message);
    }
}
```

### ê²°ê³¼
ìœ„ì™€ ê°™ì´ Spring Integrationì„ í†µí•´ TCP ì´ë²¤íŠ¸ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ë„ë¡ êµ¬í˜„í•¨ìœ¼ë¡œì¨ `MessageService`ì—ì„œ `EventMessage`ê°ì²´ë¥¼ í†µí•´ ë‹¤ì–‘í•œ ì œì–´ë¥¼ ìœ„í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
